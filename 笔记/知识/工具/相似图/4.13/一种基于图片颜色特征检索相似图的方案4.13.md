# 一、缩略语和关键术语定义


**CIELab 颜色空间**：它由三个部分组成：亮度（L）和两个颜色通道（a和b）。亮度L表示颜色的明暗程度，而a和b表示颜色的色度，其中a从绿色到红色，b从蓝色到黄色。CIELab颜色空间广泛应用于颜色管理和图像处理中，因为它能更好地模拟人眼对颜色差异的感知。

**颜色直方图特征向量**：颜色直方图特征向量是一种有效的图像表示方法，它捕捉了图像的颜色信息，同时忽略了空间信息。这使得它们非常适合于那些对图像的空间细节要求不高，但需要考虑颜色分布差异的应用场景。

**SSIM（结构相似性指数）**：SSIM 是一种衡量两张图像相似度的指标，它考虑了亮度、对比度和结构这三个维度。但在实际计算过程中，会将彩色图片转为灰度图，所以会丢失色彩信息而保留空间信息。SSIM 可以提供一个综合的相似度评分，反映了图像在视觉结构上的相似性。


# 二、背景技术

## 1、相关技术背景
相似图片搜索技术是一种利用计算机视觉和机器学习技术，通过分析图片的视觉特征和内容，来寻找与指定图片相似的其他图片的技术。这种技术的背景包括图像特征提取、相似度度量、索引方法和大规模数据处理等方面的研究。常见的相似图片搜索技术包括基于特征描述子的方法（如 SIFT、SURF、ORB 等）、基于深度学习的方法（如 CNN 特征提取）以及基于哈希索引的方法等。这些技术的发展使得相似图片搜索在诸如电子商务、图像管理、安全监控等领域得到了广泛的应用。

## 2、与本发明相关的现有技术
相似图片搜索技术有多种方案，包括基于传统特征描述的方法、基于深度学习的方法以及基于哈希索引的方法等。
1. 基于传统特征描述子的方法：
    - 方案：使用传统的特征描述子如SIFT（尺度不变特征变换）、SURF（加速稳健特征）、ORB（Oriented FAST and Rotated BRIEF）等进行特征提取，并利用特征间的相似度度量方法（如欧氏距离、汉明距离等）进行相似图片搜索。
    - 缺点：对于大规模数据的搜索速度较慢，同时不太适用于处理复杂的场景和多样化的图像。
2. 基于深度学习的方法：
    - 方案：利用深度学习模型（如卷积神经网络）对图像进行特征提取，并通过计算特征向量之间的相似度进行相似图片搜索。
    - 缺点：对于小样本数据需求较大，需要大量训练数据，同时需要较强的计算资源。
3. 基于哈希索引的方法：
    - 方案：利用哈希函数将图像特征映射到低维度的二进制编码，并建立索引结构进行相似图片搜索。
    - 缺点：哈希方法可能会损失一定的特征信息，降低搜索的准确性，尤其在处理复杂图像时表现不佳。
综合来看，不同的相似图片搜索技术方案各有优缺点。基于传统特征描述子的方法对光照变化、旋转、尺度变化等具有一定的鲁棒性，但在大规模数据处理和复杂场景下表现较差；基于深度学习的方法能够学习复杂特征，适用于处理复杂场景下的相似图片搜索，但需要大量训练数据和较强的计算资源；基于哈希索引的方法适用于大规模数据的高效相似图片搜索，但可能会损失一定的特征信息。

# 三、本发明技术方案的技术概述

## 1、本发明要解决的技术问题：
本系统旨在通过分析图片的颜色特征来检索相似图像，采用一种新颖的颜色直方图和 SSIM 计算结构相似度相结合的方法，以提高检索的准确性和效率。
1.研究高维颜色空间下的相似图片搜索算法，图片特征提取、相似度计算、数据存储与索引方案设计。
2.开发实际可用的检索工具，代码实现图片特征提取、相似度计算、数据存储与索引功能。该工具的实现需要考虑效率、准确性和用户友好性，并且需要进行充分的性能优化以处理大规模的图片数据。同时，需要确保用户界面友好，并提供直观的搜索结果展示。


## 2、技术原理简要说明：

**算法原理**：
1、颜色空间转换与局部特征提取：
首先将输入的RGB图片转换成CIELab颜色空间。CIELab颜色空间更接近于人眼对颜色的感知，因此更适合进行颜色特征的分析。

2、颜色直方图构建：
在得到关键颜色区域后，接下来对每个区域构建颜色直方图。颜色直方图是一种统计图像中颜色分布的工具，它通过统计每个颜色通道（L、a、b）中的像素数量来表示图像的颜色组成。在CIELab颜色空间中，每个通道的像素值被分配到预定义的区间内，并计算每个区间的像素数量，从而得到颜色直方图。


3、颜色直方图特征向量生成：
颜色直方图完成后，需要将其转换为可以用于计算相似度的特征向量。这一步骤涉及将每个颜色区域的颜色直方图数据转换为数值向量，这些向量捕捉了每个区域的颜色分布特征。为了消除不同区域大小带来的影响，通常会对这些特征向量进行归一化处理，使得每个向量的长度为1。

4、相似度计算：
采用改进的相似度计算方法，结合颜色直方图和结构相似性指数（SSIM）来衡量两张图片之间的相似度。
通过计算颜色直方图特征向量和 SSIM 值，得到一个综合的相似度评分。

5、数据存储与索引：
将生成的特征向量和相似度评分存储在数据库中，建立高效的索引结构，以便快速检索。

6、用户交互与搜索结果展示：
开发用户友好的界面，允许用户上传图片并设置搜索参数（如相似度阈值）。
展示搜索结果，包括图片预览、相似度评分等信息，使用户能够直观地评估和选择相似图片。



# 四、本发明技术方案的具体实施

## 1、详细描述本发明为解决前文所提到的技术问题, 采用了那些技术方案细节, 为什么需要采用这些技术细节

**步骤1：颜色空间转换与局部特征提取**

1.1 **颜色空间转换**

- **1.1.1** 输入：用户上传的 RGB 格式图片。
	![](附件/Pasted%20image%2020240414145022.png)
- **1.1.2** 转换：使用图像处理库（如 OpenCV）中的函数将图片从 RGB 转换到 CIELab 颜色空间。这是因为 CIELab 颜色空间更接近于人类视觉的感知方式，有助于更好地处理颜色信息。将 CIELab 图片转换为数值矩阵。在这个矩阵中，每一行代表一个像素点，每一列代表一个颜色通道（L、a、b），因此每个像素点由三个数值组成。
	![](附件/Pasted%20image%2020240414145041.png)


通过上述步骤，我们可以获得图像的 CIELab 颜色空间数据。


**步骤2：颜色直方图构建**
通过步骤 1 得到图像的 CIELab 颜色空间数据后，接下来对其构建颜色直方图。

**2.1 区间划分**

- **2.1.1** 确定区间数量：首先，决定每个 CIELab 通道（L、a、b）将被划分成多少个区间。例如，如果我们选择将每个通道划分为5个区间。
- **2.1.2** 计算区间宽度：接下来，计算每个通道的范围除以区间数量来确定每个区间的宽度。例如，L 通道范围是 0-100，分为 5 各区间，区间边界是\[0-20, 21-40, 41-60, 61-80, 81-100]。对于 a 和 b 通道，由于它们的范围是-128到127，我们可以也将每个通道分为5个区间：\[-128-102, -101-86, -85-70, -69-54, -53-127]。

**2.2 统计**

- **2.2.1** 初始化直方图：为每个通道创建一个长度等于区间数量的直方图数组，每个元素的初始值设为0。
- **2.2.2** 遍历像素点：遍历图像中的每个像素点，读取其CIELab值，并确定每个通道的像素值落在哪个区间内。
- **2.2.3** 更新直方图：对于每个像素点，将其对应的 L、a、b 通道的区间索引加 1，从而在直方图中累积该颜色的出现次数。

例如，对于 L 通道，我们可以得到以下直方图：区间为横轴，像素个数为纵轴

- 区间\[0-20]：没有像素
- 区间\[21-40]：1个像素（来自第一个像素的 L*值82）
- 区间\[41-60]：1个像素（来自第二个像素的 L*值97）
- 区间\[61-80]：1个像素（来自第三个像素的 L*值130）
- 区间\[81-100]：2个像素（来自第四和第六个像素的 L*值224和160）

类似地，我们可以为 a 和 b 通道构建直方图。

**2.3 向量化**

- **2.3.1** 直方图向量：将每个通道的直方图转换为一个向量。例如，如果 L 通道有5个区间，那么它的直方图向量将是一个包含 5个元素的数组。
- **2.3.2** 合并向量：将每个通道的向量合并成一个多维数组，这个数组将作为图像的颜色特征向量。例如，用上面的例子， L 通道的向量是\[0, 2, 1, 1, 1]，a 通道的向量是\[1, 1, 2, 1, 1]，b 通道的向量是\[0, 1, 3, 1, 1]，则合并后的特征向量为一个 15维数组（因为 5个区间 * 3个通道 = 15）。

通过这些步骤，我们可以得到一个代表整个图像颜色分布的特征向量，它将用于后续的相似度计算和检索过程。

该步骤输出结果\[0, 2, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 3, 1, 1]


**步骤3：特征向量生成**

- **3.1** 归一化：对步骤 2 中得到的特征向量进行 L 2 归一化，使其长度为 1，以比较不同图像的颜色分布时消除图像大小的影响。
	- **3.1.1** 计算特征向量的 L 2 范数（欧几里得范数）： $$
∣∣v∣∣2​=v12​+v22​+...+vn2​​
$$
	其中，$v$ 是特征向量，$vi$ 是向量中的第 $i$ 个元素，$n$ 是向量的维度。
    
	- **3.1.2** 对每个特征向量进行归一化处理： $$vnormalized​=∣∣v∣∣2​v​$$
	这样，归一化后的特征向量 $Vnormalized​$ ​ 的长度（或范数）将为 1。
	
	步骤 2 数据经计算 L 2 范数为6.324，各除以 6 之后得到归一化向量为：
	\[0.0000, 0.3165, 0.1587, 0.1587, 0.1587, 0.1587, 0.1587, 0.3165, 0.1587, 0.1587, 0.0000, 0.1587, 0.4732, 0.1587, 0.1587]
	

通过这个步骤，我们得到了一组标准化的、可用于比较和计算相似度的特征向量，这些特征向量将用于系统中的相似图片检索和比较



**步骤4：相似度计算**

- **4.1** 颜色直方图特征向量相似度计算
	通过步骤 1、2、 3 得到的颜色直方图特征向量，可以用来和其他图片的颜色特征向量进行比对。
	使用余弦相似度来计算两个向量之间的相似度。余弦相似度的计算公式为:
	`余弦相似度 = (A · B) / (||A|| * ||B||)`
	其中 `A` 和 `B` 是两个特征向量，`·` 表示向量的点积，`||A||` 和 `||B||` 分别是向量 `A` 和 `B` 的 L 2 范数。
	假设计算出的余弦相似度为0.8，说明这组数据在颜色上有一定相似。
- **4.2** SSIM 计算：使用 SSIM 算法计算两张图片的结构相似性指数。
	颜色直方图特征向量相似度只能代表颜色上的相似，忽略了结构上的相似程度，SSIM 考虑了图像的局部结构信息，能够评估图像中的边缘、纹理和形状等特征的相似性，所以这里再通过 SSIM 衡量两张图像相似度。
	- **4.3.1** 输入为原图像，对待检索图片和参考图片的对应像素点，计算它们的亮度、对比度和结构信息。
	- **4.3.2** 使用这些信息来计算两张图片之间的 SSIM 值，公式如下：
		其中，μx​ 和 μy​ 分别是两幅图的均值，σxy​ 是协方差，$σx2​$ ​ 和 2σy 2​ 是方差，1 c 1​ 和 2 c 2​ 是为了避免分母为零而加入的小常数。
	在代码实现上可以`scikit-image`库中的`compare_ssim`函数或其他SSIM实现来计算两张图像的SSIM值。
- **4.4** 相似度评分：结合颜色直方图特征向量相似度和 SSIM 值，通过加权平均的方法得到最终的相似度评分。
	- **4.4.1** 为颜色直方图特征向量相似度和 SSIM 值分配权重。
	- **4.4.2** 通过加权平均的方法，结合所有参数来计算最终的相似度评分。公式如下： $$
Similarity Score=w1​⋅Contrast+w2​⋅Homogeneity+w3​⋅SSIM
$$ 其中，$w1$ ​、$w2$ ​​ 和 $w3$ ​​ 是分配给对比度、同质性和 SSIM 的权重。
通过这些步骤，我们可以得到一个综合考虑颜色分布、对比度、同质性和结构信息的相似度评分，用于评估两张图片的相似性。这个评分将用于后续的相似图片检索和排序。



**步骤5：数据存储与索引**

- **5.1** 数据库设计：设计数据库结构，存储图片的特征向量和相似度评分。

**步骤6：用户交互与搜索结果展示**

- **6.1** 用户界面：开发一个图形用户界面（GUI），允许用户上传图片并设置搜索参数。
- **6.2** 搜索请求处理：当用户提交搜索请求时，系统将提取上传图片的颜色特征，并通过索引结构查询数据库中的相似图片。
- **6.3** 结果展示：将搜索结果以列表形式展示，包括图片缩略图、文件名、路径、相似度评分等信息。用户可以通过评分排序或手动选择感兴趣的图片。



## 2、本发明带来的有益效果：

- 通过结合颜色直方图和结构相似性，本系统能够更准确地捕捉图片的颜色特征，提高相似图片检索的准确性。
- 采用改进的相似度计算方法，不仅考虑颜色的分布，还考虑颜色的空间关系，使得检索结果更加符合人眼观察到的相似性。
- 优化的数据存储和索引结构使得系统能够处理大规模的图片数据，提高检索效率。

## 3、针对上述技术方案是否还有替代方案同样能完成发明目的：

可以利用基于深度学习的方法来学习图片颜色分布的特征表示，通过神经网络等技术实现相似图片搜索。此外，也可以考虑使用局部特征描述子（如 SIFT、SURF）或者基于哈希索引的方法来进行相似图片搜索。这些方法可能会在精度、鲁棒性或者适用场景等方面有所差异，需要根据具体应用需求进行选择。



# 五、附件
参考文献
https://blog.csdn.net/u013066730/article/details/105642444
https://blog.csdn.net/qq_29422251/article/details/79445571
https://blog.csdn.net/weixin_32487755/article/details/112496382

工具截图：
![](http://km.fp.ps.netease.com/file/65322a1e94064f5d24433301W3eV4y0m05)


第一发明人名字：黄厚锋
