# #737155 【重要】房间基础结构优化

[x] 日志

[ ] 在Serviece中直接Inject controller 研究下

[ ] 调整插件首次加入的大小

1、优化-插件容器重构

现状：如果有业务插件需要加入右下角区域，目前通过viewId直接获取右下角容器然后添加，但无法保证与其它业务插件间的插入的相对顺序；且一旦插件增多，维护会比较麻烦。

改进：封装右下角插件管理类，为目前已有插件定义优先级，在各插件插入容器时会根据优先级返回应插入位置。

效益：后续添加插件会变得简单，只需调用管理类对外暴露接口，无需关注容器viewId、时序问题以及内部如何实现。

问题：更改了插件父容器，可能部分品类房间没有对应父容器或者controller没有在相应register

2、大小插件布局是设置成0的，由前端后续修改；要注意其它插件不能也实现成这种

```
LinearLayout.LayoutParams layoutParams = new LayoutParams(0, 0);
```

3、开关

ABtest控制可见人群

```
com.netease.cc.util.RoomPluginRevisionSwitch
sceneId(10130, 10121)
```

Appconfig控制可见品类

```
①key用disable_2024_room_gametypes
value的gametype用英文逗号分开
比如：95599,195601   代表95599和195601这两个品类不支持新样式

②不配置disable_2024_room_gametypes，则代表所有gametype都支持
```

---

|需求名称 | #737155 【重要】房间基础结构优化 [https://icc.pm.netease.com/v6/issues/737155](https://icc.pm.netease.com/v6/issues/737155)                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|分支     |#737155_plugin_and_chat_revision                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|需求文档 |[https://docs.popo.netease.com/team/pc/east/pageDetail/e22e1e9abd554324b730ff27c7bb308a](https://docs.popo.netease.com/team/pc/east/pageDetail/e22e1e9abd554324b730ff27c7bb308a)                                                                                                                                                                                                                                                                                                                                                                                |
|交互稿   |[https://www.figma.com/file/qQamdw9UxNQSGwTumvVsIk/2023%E3%80%90%E4%BD%93%E9%AA%8C%E4%B8%93%E9%A1%B9%E3%80%91%E5%A4%A7%E5%A8%B1%E4%B9%90%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9B%B4%E6%92%AD%E9%97%B4%E6%94%B9%E9%80%A0?type=design&node-id=523-58627&mode=design&t=jMxIzMrBDilcNQzj-0](https://www.figma.com/file/qQamdw9UxNQSGwTumvVsIk/2023%E3%80%90%E4%BD%93%E9%AA%8C%E4%B8%93%E9%A1%B9%E3%80%91%E5%A4%A7%E5%A8%B1%E4%B9%90%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9B%B4%E6%92%AD%E9%97%B4%E6%94%B9%E9%80%A0?type=design&node-id=523-58627&mode=design&t=jMxIzMrBDilcNQzj-0)|
|UI稿     |[https://www.figma.com/file/UWTRjJK590w6Hyh5LHeK3e/%23737338-2023%E5%A8%B1%E4%B9%90%E8%AF%AD%E9%9F%B3%E7%9B%B4%E6%92%AD%E9%97%B4%E6%94%B9%E7%89%88?type=design&node-id=13-4621&mode=design&t=vRRE8kZO5YqD7Iuf-0](https://www.figma.com/file/UWTRjJK590w6Hyh5LHeK3e/%23737338-2023%E5%A8%B1%E4%B9%90%E8%AF%AD%E9%9F%B3%E7%9B%B4%E6%92%AD%E9%97%B4%E6%94%B9%E7%89%88?type=design&node-id=13-4621&mode=design&t=vRRE8kZO5YqD7Iuf-0)                                                                                                                                |
|排期     |[https://docs.popo.netease.com/lingxi/75405631b8bf47019fdb7dde300826ba?xyz=1700797351991&tab=0&xyz=1702299668261](https://docs.popo.netease.com/lingxi/75405631b8bf47019fdb7dde300826ba?xyz=1700797351991&tab=0&xyz=1702299668261)                                                                                                                                                                                                                                                                                                                              |
|日志     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|耗时     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|备注     |原生插件统计：[https://docs.popo.netease.com/lingxi/75405631b8bf47019fdb7dde300826ba?tab=1&xyz=1702299668261&xyz=1702448924062](https://docs.popo.netease.com/lingxi/75405631b8bf47019fdb7dde300826ba?tab=1&xyz=1702299668261&xyz=1702448924062)                                                                                                                                                                                                                                                                                                                |

需求耗时评估

|功能|拆分|耗时评估|
|----|----|--------|
|    |    |        |

截图

|功能|截图|耗时|
|----|----|----|
|    |    |    |
